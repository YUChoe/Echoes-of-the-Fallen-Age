# ê´€ë¦¬ì ê¸°ëŠ¥ êµ¬í˜„ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

## ê°œìš”
ì´ ë¬¸ì„œëŠ” Python MUD Engineì˜ ê´€ë¦¬ì ê¸°ëŠ¥ êµ¬í˜„ ê³¼ì •ì—ì„œ ë°œìƒí•œ ì‹¤ìˆ˜ë“¤ì„ ë¶„ì„í•˜ê³ , í–¥í›„ ìœ ì‚¬í•œ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ë¥¼ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.

## ğŸš¨ ì£¼ìš” ì‹¤ìˆ˜ ë¶„ì„

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ë¡œì§ ë¶ˆì¼ì¹˜
**ë¬¸ì œ**: WorldManagerì˜ ë©”ì„œë“œë“¤ì´ ê°ì²´ë¥¼ ì§ì ‘ Repositoryì— ì „ë‹¬í–ˆì§€ë§Œ, RepositoryëŠ” ë”•ì…”ë„ˆë¦¬ë¥¼ ìš”êµ¬í•¨
**ì›ì¸**:
- ëª¨ë¸ ê°ì²´ì™€ Repository ì¸í„°í˜ì´ìŠ¤ ê°„ì˜ ë¶ˆì¼ì¹˜
- ì½”ë“œ ì‘ì„± ì‹œ Repositoryì˜ ì‹¤ì œ êµ¬í˜„ í™•ì¸ ë¶€ì¡±

**í•´ê²°ì±…**:
- ëª¨ë“  ëª¨ë¸ ê°ì²´ëŠ” `to_dict()` ë©”ì„œë“œë¥¼ í†µí•´ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜ í›„ ì €ì¥
- Repository ì¸í„°í˜ì´ìŠ¤ì™€ ëª¨ë¸ ê°ì²´ ê°„ì˜ ì¼ê´€ì„± ìœ ì§€

**êµí›ˆ**:
```python
# âŒ ì˜ëª»ëœ ë°©ë²•
created_room = await self._room_repo.create(room)

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
created_room = await self._room_repo.create(room.to_dict())
```

### 2. ì˜ì¡´ì„± ì£¼ì… ëˆ„ë½
**ë¬¸ì œ**: ë©”ì¸ í•¨ìˆ˜ì—ì„œ ì„œë²„ ìƒì„± ì‹œ `db_manager`ë¥¼ ì „ë‹¬í•˜ì§€ ì•ŠìŒ
**ì›ì¸**:
- ì˜ì¡´ì„± ì²´ì¸ ì¶”ì  ë¶€ì¡±
- ì´ˆê¸°í™” ìˆœì„œì— ëŒ€í•œ ì´í•´ ë¶€ì¡±

**í•´ê²°ì±…**:
- ëª¨ë“  ì˜ì¡´ì„±ì„ ëª…ì‹œì ìœ¼ë¡œ ì£¼ì…
- ì´ˆê¸°í™” ìˆœì„œ ë¬¸ì„œí™”

**êµí›ˆ**:
```python
# âŒ ì˜ëª»ëœ ë°©ë²•
server = MudServer(host, port, player_manager)

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
server = MudServer(host, port, player_manager, db_manager)
```

### 3. ëˆ„ë½ëœ ì†ì„± ì°¸ì¡°
**ë¬¸ì œ**: GameEngineì—ì„œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” `chat_manager` ì†ì„± ì°¸ì¡°
**ì›ì¸**:
- ì½”ë“œ ë³µì‚¬/ë¶™ì—¬ë„£ê¸° ì‹œ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ ë¶€ì¡±
- í´ë˜ìŠ¤ êµ¬ì¡°ì— ëŒ€í•œ ë¶ˆì™„ì „í•œ ì´í•´

**í•´ê²°ì±…**:
- ì†ì„± ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í›„ ì‚¬ìš©
- ë°©ì–´ì  í”„ë¡œê·¸ë˜ë° ì ìš©

**êµí›ˆ**:
```python
# âŒ ì˜ëª»ëœ ë°©ë²•
self.chat_manager.subscribe_to_channel(player.id, "ooc")

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
if hasattr(self, 'chat_manager') and self.chat_manager:
    self.chat_manager.subscribe_to_channel(player.id, "ooc")
```

### 4. ëª…ë ¹ì–´ ë“±ë¡ ì‹œìŠ¤í…œ ë¯¸ì™„ì„±
**ë¬¸ì œ**: ê´€ë¦¬ì ëª…ë ¹ì–´ê°€ ì •ì˜ë˜ì—ˆì§€ë§Œ ì‹¤ì œë¡œ ë“±ë¡ë˜ì§€ ì•ŠìŒ
**ì›ì¸**:
- ëª…ë ¹ì–´ ì‹œìŠ¤í…œì˜ ì „ì²´ í”Œë¡œìš° ì´í•´ ë¶€ì¡±
- import ë¬¸ì œë¡œ ì¸í•œ ë“±ë¡ ì‹¤íŒ¨

**í•´ê²°ì±…**:
- ëª…ë ¹ì–´ ë“±ë¡ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ í™•ì¸
- ë¡œê¹…ì„ í†µí•œ ë“±ë¡ ìƒíƒœ ëª¨ë‹ˆí„°ë§

**êµí›ˆ**:
- ê¸°ëŠ¥ êµ¬í˜„ í›„ ë°˜ë“œì‹œ end-to-end í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
- ë¡œê·¸ë¥¼ í†µí•´ ê° ë‹¨ê³„ë³„ ì„±ê³µ ì—¬ë¶€ í™•ì¸

### 5. íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±
**ë¬¸ì œ**: datetime ê°ì²´ì™€ ë¬¸ìì—´ ê°„ì˜ íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ `isoformat()` ì˜¤ë¥˜
**ì›ì¸**:
- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°˜í™˜ë˜ëŠ” ë°ì´í„° íƒ€ì…ì— ëŒ€í•œ ê°€ì •
- íƒ€ì… ê²€ì¦ ë¡œì§ ë¶€ì¡±

**í•´ê²°ì±…**:
- ë°©ì–´ì  íƒ€ì… ê²€ì¦ êµ¬í˜„
- íƒ€ì… íŒíŠ¸ ì ê·¹ í™œìš©

**êµí›ˆ**:
```python
# âŒ ìœ„í—˜í•œ ë°©ë²•
return dt.isoformat()

# âœ… ì•ˆì „í•œ ë°©ë²•
def _format_datetime(self, dt) -> Optional[str]:
    if dt is None:
        return None
    if isinstance(dt, str):
        return dt
    if hasattr(dt, 'isoformat'):
        return dt.isoformat()
    return str(dt)
```

## ğŸ“‹ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ ì „ í™•ì¸ì‚¬í•­
- [ ] ì˜ì¡´ì„± ì²´ì¸ ì „ì²´ ë§¤í•‘
- [ ] Repository ì¸í„°í˜ì´ìŠ¤ í™•ì¸
- [ ] ëª¨ë¸ ê°ì²´ì˜ ì§ë ¬í™” ë©”ì„œë“œ ì¡´ì¬ í™•ì¸
- [ ] íƒ€ì… íŒíŠ¸ ë° ê²€ì¦ ë¡œì§ ê³„íš

### êµ¬í˜„ ì¤‘ í™•ì¸ì‚¬í•­
- [ ] ê° ë©”ì„œë“œì˜ ì…ì¶œë ¥ íƒ€ì… ì¼ì¹˜ì„± í™•ì¸
- [ ] ì˜ˆì™¸ ì²˜ë¦¬ ë° ë¡œê¹… ì¶”ê°€
- [ ] ë°©ì–´ì  í”„ë¡œê·¸ë˜ë° ì ìš©
- [ ] ë‹¨ìœ„ë³„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### êµ¬í˜„ í›„ í™•ì¸ì‚¬í•­
- [ ] End-to-end í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
- [ ] ë¡œê·¸ë¥¼ í†µí•œ ì „ì²´ í”Œë¡œìš° í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì‹¤ì œ ì €ì¥ í™•ì¸
- [ ] ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

## ğŸ”§ ê¶Œì¥ ê°œë°œ íŒ¨í„´

### 1. ê³„ì¸µë³„ ì±…ì„ ë¶„ë¦¬
```python
# Controller Layer (ëª…ë ¹ì–´ ì²˜ë¦¬)
async def execute_admin(self, session: Session, args: List[str]) -> CommandResult:
    # ì…ë ¥ ê²€ì¦ë§Œ ìˆ˜í–‰

# Service Layer (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
async def create_room_realtime(self, room_data: Dict[str, Any]) -> bool:
    # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬

# Repository Layer (ë°ì´í„° ì ‘ê·¼)
async def create(self, data: Dict[str, Any]) -> Model:
    # ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ë§Œ ìˆ˜í–‰
```

### 2. ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°
```python
# í•­ìƒ íƒ€ì…ê³¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
if not isinstance(data, dict):
    raise ValueError("Dictionary expected")

if not hasattr(obj, 'required_method'):
    logger.warning("Required method not found")
    return None
```

### 3. ëª…ì‹œì  ì˜ì¡´ì„± ì£¼ì…
```python
# ìƒì„±ìì—ì„œ ëª¨ë“  ì˜ì¡´ì„± ëª…ì‹œ
def __init__(self,
             session_manager: SessionManager,
             player_manager: PlayerManager,
             db_manager: DatabaseManager):
    # ì˜ì¡´ì„± ê²€ì¦
    if not all([session_manager, player_manager, db_manager]):
        raise ValueError("All dependencies are required")
```

### 4. í¬ê´„ì  ë¡œê¹…
```python
# ê° ë‹¨ê³„ë³„ ë¡œê¹… ì¶”ê°€
logger.info(f"Starting {operation_name}")
try:
    result = await operation()
    logger.info(f"{operation_name} completed successfully")
    return result
except Exception as e:
    logger.error(f"{operation_name} failed: {e}", exc_info=True)
    raise
```

## ğŸ¯ í–¥í›„ ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­

1. **ì˜ì¡´ì„± ì²´ì¸ í™•ì¸**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ì „ì²´ ì˜ì¡´ì„± ì²´ì¸ì„ ë¨¼ì € ë§¤í•‘
2. **íƒ€ì… ì•ˆì „ì„±**: ëª¨ë“  ì™¸ë¶€ ë°ì´í„°ì— ëŒ€í•´ íƒ€ì… ê²€ì¦ ìˆ˜í–‰
3. **ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸**: ê° ê³„ì¸µë³„ë¡œ ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
4. **ë¡œê¹… í™œìš©**: ë””ë²„ê¹…ì„ ìœ„í•œ ì¶©ë¶„í•œ ë¡œê¹… ì •ë³´ ì œê³µ
5. **ë¬¸ì„œí™”**: ë³µì¡í•œ ë¡œì§ì— ëŒ€í•œ ëª…í™•í•œ ì£¼ì„ ë° ë¬¸ì„œ ì‘ì„±

## ğŸ“š ì°¸ê³  ìë£Œ

- Repository íŒ¨í„´ êµ¬í˜„ ê°€ì´ë“œ
- Python íƒ€ì… íŒíŠ¸ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤
- ì˜ì¡´ì„± ì£¼ì… íŒ¨í„´
- ë°©ì–´ì  í”„ë¡œê·¸ë˜ë° ê¸°ë²•