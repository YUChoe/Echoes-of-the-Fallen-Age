# 구현 계획

- [x] 1. 프로젝트 구조 및 기본 설정 구성

  - 프로젝트 디렉토리 구조 생성 (src, tests, static 폴더)
  - requirements.txt 파일 생성 (aiohttp, aiosqlite 등 의존성)
  - 기본 설정 파일 및 환경 변수 설정
  - _요구사항: 1.1, 7.4_

- [x] 2. SQLite 데이터베이스 스키마 및 연결 구현

  - 데이터베이스 스키마 생성 스크립트 작성
  - 데이터베이스 연결 및 초기화 클래스 구현
  - 기본 CRUD 연산을 위한 베이스 리포지토리 클래스 작성
  - _요구사항: 9.1, 9.3, 9.4_

- [x] 3. 핵심 데이터 모델 구현

  - Player, Character, Room, GameObject 데이터 클래스 정의
  - 각 모델에 대한 유효성 검증 메서드 구현
  - 모델 간 관계 및 참조 무결성 처리
  - _요구사항: 2.2, 2.3, 6.1_

- [x] 4. 다국어 지원 시스템 구현

  - I18nManager 클래스 구현 (영어/한국어 지원)
  - 번역 텍스트 로딩 및 캐싱 시스템
  - 로케일별 텍스트 반환 메서드 구현
  - _요구사항: 10.1, 10.2, 10.3, 10.6_

- [x] 5. 플레이어 인증 시스템 구현

  - 비밀번호 해싱 및 검증 (bcrypt 사용)
  - 플레이어 계정 생성 및 로그인 로직
  - 세션 관리 및 인증 상태 유지
  - _요구사항: 2.1, 2.2, 2.3, 2.4_

- [x] 6. aiohttp 웹 서버 기본 구조 구현

  - MudServer 클래스 생성 및 서버 시작/중지 메서드
  - 정적 파일 서빙 핸들러 (HTML, CSS, JS)
  - 기본 라우팅 설정 및 미들웨어 구성
  - Pico.css 기반 현대적 웹 인터페이스 구현
  - _요구사항: 1.1, 1.2, 1.3_

- [x] 7. WebSocket 연결 및 세션 관리 구현

  - WebSocket 핸들러 구현 및 연결 관리
  - Session 클래스 구현 (플레이어-WebSocket 매핑)
  - 연결 해제 시 세션 정리 로직
  - SessionManager를 통한 다중 세션 관리
  - 기본 게임 명령어 구현 (help, who, stats, quit)
  - _요구사항: 2.1, 7.2_

- [x] 8. 게임 엔진 코어 및 이벤트 시스템 구현

  - GameEngine 메인 클래스 구현
  - EventBus를 통한 이벤트 발행/구독 시스템
  - 플레이어 세션 추가/제거 및 방 브로드캐스트 기능
  - 이벤트 타입 정의 및 이벤트 히스토리 관리
  - 서버와 GameEngine 완전 통합
  - _요구사항: 4.1, 4.2, 6.5_

- [x] 9. 명령어 처리 시스템 구현

  - CommandProcessor 클래스 및 명령어 파싱 로직
  - 기본 명령어들 구현 (say, tell, who, look)
  - 명령어 등록 및 실행 시스템
  - _요구사항: 4.1, 4.2, 4.3, 4.4_

- [x] 10. 게임 세계 관리 시스템 구현

  - WorldManager 클래스 및 방 관리 기능
  - 방 생성, 수정, 조회 메서드 구현
  - 게임 객체 관리 및 위치 추적 시스템
  - _요구사항: 6.1, 6.2, 6.3_

- [x] 11. 플레이어 이동 및 탐색 시스템 구현

  - 방향 명령어 처리 (north, south, east, west)
  - 방 설명 및 출구 정보 표시 로직
  - 이동 시 다른 플레이어들에게 알림 기능
  - _요구사항: 3.1, 3.2, 3.3, 3.4_

- [x] 12. 객체 상호작용 시스템 구현

  - get, drop, inventory, examine 명령어 구현
  - 인벤토리 관리 및 객체 위치 변경 로직
  - 객체 상태 변경 시 실시간 업데이트
  - _요구사항: 5.1, 5.2, 5.3, 5.4_

- [x] 13. 웹 클라이언트 기본 UI 구현

  - HTML 기본 구조 및 CSS 스타일링
  - WebSocket 연결 및 메시지 처리 JavaScript
  - 텍스트 입력창 및 게임 출력 영역 구현
  - _요구사항: 8.1, 8.5_

- [x] 14. 하이브리드 인터페이스 구현

  - 동적 버튼 생성 (출구, 객체, 액션)
  - 텍스트 명령어와 버튼 클릭 통합 처리
  - 자동완성 힌트 시스템 구현
  - _요구사항: 8.2, 8.3, 8.4, 8.5_

- [x] 15. 관리자 기능 구현

  - 실시간 방 생성 및 편집 기능
  - 객체 생성 및 배치 시스템
  - 플레이어 관리 (킥, 밴, 권한 변경)
  - 관리자 웹 UI 패널 구현 (모달 기반)
  - 관리자 명령어와 서버 API 연동
  - **수정 필요**: WorldManager.create_room()에서 Room 객체를 딕셔너리로 변환하여 DB 저장
  - _요구사항: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 15.1. 관리자 기능 DB 저장 문제 수정

  - WorldManager.create_room() 메서드에서 Room 객체를 딕셔너리로 변환하여 DB 저장
  - WorldManager.update_room() 메서드 DB 저장 로직 검증
  - WorldManager.create_object() 메서드 DB 저장 로직 검증
  - 관리자 명령어 실행 후 실제 DB 반영 테스트
  - _요구사항: 6.1, 6.2, 6.3_

- [x] 15.2. 관리자 패널 목록 조회 기능 추가

  - 방 목록 조회 API 및 웹 UI 구현
  - 객체 목록 조회 API 및 웹 UI 구현
  - 플레이어 목록 조회 API 및 웹 UI 구현
  - 관리자 패널에 목록 탭 추가 및 실시간 업데이트
  - _요구사항: 6.4, 6.5_

- [x] 16. 플레이어와 객체 상호작용 시스템 구현

  - 플레이어 이동 시 방 내 모든 플레이어에게 입장/퇴장 메시지 전파
  - 플레이어 액션(say, emote, get, drop) 시 같은 방 플레이어들에게 실시간 알림
  - 객체 상태 변경 시 방 내 모든 플레이어에게 업데이트 전송
  - 플레이어 간 상호작용 명령어 구현 (emote, give, follow, whisper, players)
  - 방 내 플레이어 목록 실시간 업데이트 및 웹 UI 반영
  - 플레이어 상태 변경(로그인/로그아웃) 시 전체 알림 시스템
  - **follow 기능 완전 구현**: 무한 재귀 방지, 자동 이동, 연결 해제 시 정리
  - _요구사항: 3.3, 4.2, 5.4, 7.2_

- [x] 17. 플레이어 능력치 시스템 구현

  - **1차 능력치 (기본 스탯)**: STR, DEX, INT, WIS, CON, CHA 데이터 모델 추가
  - **2차 능력치 (파생 스탯)**: HP, MP, STA, ATK, DEF, SPD, RES, LCK, INF 계산 로직 구현
  - Player 모델에 능력치 필드 추가 및 DB 스키마 업데이트
  - 능력치 계산 및 업데이트 메서드 구현 (레벨업, 장비 착용 시)
  - stats 명령어 확장 - 상세 능력치 표시 기능
  - 웹 UI에 능력치 모달 패널 추가 (실시간 업데이트, 반응형 디자인)
  - 능력치 기반 행동 성공률 계산 시스템 구현
  - 데이터베이스 마이그레이션 스크립트 작성 및 실행
  - 모달 기반 UI로 레이아웃 문제 해결
  - _요구사항: 2.2, 2.3, 8.1_

- [x] 18. 고급 인벤토리 시스템 구현

  - **무게 시스템**: 모든 GameObject에 weight 속성 추가 및 DB 스키마 업데이트
  - **용량 제한**: 플레이어별 최대 소지 무게 계산 (STR 기반)
  - **카테고리 분류**: 무기, 방어구, 소모품, 기타 아이템 분류 시스템
  - **장비 슬롯**: 착용 가능한 장비 슬롯 정의 (무기, 갑옷, 액세서리)
  - inventory 명령어 확장 - 카테고리별 정렬, 무게 표시
  - equip/unequip 명령어 구현 - 장비 착용/해제 기능
  - 웹 UI 인벤토리 패널 개선 - 드래그&드롭, 필터링 기능
  - 아이템 사용(use) 명령어 구현 - 소모품 사용 로직
  - _요구사항: 5.1, 5.2, 5.3, 5.4, 8.2_

- [x] 19. 클라이언트 버그수정

  - 화면에 출력 내용 행 변환 처리 안되는 문제
  - 동서남북 이동 버튼이 클라이언트 리팩토링 이후 없어졌음
  - 방에 들어 갔을때 자동으로 look 하는 기능 클라이언트 리팩토링 이후 없어짐
  - 웹소켓 접속이 너무 늦게 되는 경우가 있음

- [x] 20. 초기 월드 구성

  - **마을 광장 서쪽 성문 생성**: 마을 광장에서 서쪽으로 연결되는 성문 방 추가
  - **8x8 숲 지역 생성**: 성문을 나가면 접근할 수 있는 64개 방으로 구성된 숲 지역
  - **숲 지역 탐험 시스템**: 각 숲 방에 고유한 설명과 특징 부여
  - **방향 연결 시스템**: 숲 내부의 north, south, east, west 이동 경로 구성
  - **경계 처리**: 숲 가장자리에서 더 이상 이동할 수 없는 경계 메시지 구현
  - **초기 데이터 로딩**: 서버 시작 시 월드 데이터 자동 생성 및 로딩
  - 숲 지역 탐험을 위한 기본 게임 객체 배치 (나무, 돌, 열매 등)
  - _요구사항: 6.1, 6.2, 3.1, 3.2_

- [x] 21. 초기 게임 캐릭터 구성과 상호작용

  - **동쪽 시장 NPC 배치**: 마을 광장 동쪽 시장에 상점 NPC 생성
  - **NPC 데이터 모델**: NPC 클래스 및 대화/거래 시스템 구현
  - **상점 시스템**: 아이템 구매/판매 기능 구현
  - **NPC 상호작용 명령어**: talk, buy, sell, shop 명령어 구현
  - **거래 인벤토리**: NPC별 판매 아이템 목록 및 재고 관리
  - **경제 시스템**: 플레이어 골드/화폐 시스템 추가
  - **대화 시스템**: NPC와의 기본 대화 및 퀘스트 힌트 제공
  - 웹 UI에 NPC 상호작용 패널 추가 (상점 인터페이스)
  - _요구사항: 6.1, 5.1, 5.2, 4.1, 4.2_

- [x] 22. 클라이언트 고도화

  - **메시지 중복 출력 문제 해결**: MessageHandler 전면 재구성으로 help, look, inventory, who 등 모든 명령어가 1번씩만 출력되도록 수정
  - **CSS 색상 일관성 개선**: .game-message.info 스타일 추가로 모든 게임 메시지가 일관된 파란색으로 표시
  - **별칭 기능 오작동 수정**: AdminCommand에서 BaseCommand로 매개변수 전달 순서 오류 수정으로 한국어 설명이 개별 문자로 분해되지 않도록 해결
  - **코드 중복 제거**: main.js와 GameModule.js의 중복된 addGameMessage 메서드 제거로 단일 메시지 출력 경로 확보
  - **베스트 프랙티스 문서화**: 문제 해결 과정의 실수 분석 및 개선 방안을 Steering 파일로 작성하여 향후 유사 문제 재발 방지
  - _요구사항: 8.1, 8.5_

- [ ] 23. 전투 시스템 구현 (단계별 분리)

- [x] 23.1. 몬스터 데이터 모델 및 기본 구조 구현

  - Monster 클래스 정의 (HP, 공격력, 방어력, 경험치, 드롭 아이템 속성)
  - Monster DB 스키마 추가 및 마이그레이션 스크립트 작성
  - MonsterRepository 클래스 구현 (CRUD 연산)
  - 기본 몬스터 데이터 생성 스크립트 작성 (슬라임, 고블린 등)
  - _요구사항: 2.2, 2.3, 6.1_

- [x] 23.2. 몬스터 스폰 시스템 구현

  - 방별 몬스터 스폰 포인트 설정 시스템
  - 몬스터 리스폰 타이머 및 스케줄러 구현
  - WorldManager에 몬스터 스폰 관리 기능 추가
  - 숲 지역에 기본 몬스터 스폰 설정
  - **검증 완료**: 서버에서 몬스터 데이터 정상 전송, 스폰 시스템 작동 확인
  - **클라이언트 표시 문제**: 별도 버그 수정 필요 (서버 기능은 정상)
  - _요구사항: 6.1, 6.2_

- [x] 23.3. 자동 전투 메커니즘 구현 (수정)

  - **Initiative 시스템**: D&D 룰 기반 턴 순서 결정 (속도 + 1d20 주사위)
  - **자동 전투 루프**: 실시간으로 턴이 진행되는 전투 시스템 구현
  - **턴 타이머**: 플레이어 액션 선택 시간 제한 (기본 2초) 구현
  - **전투 상태 머신**: 전투 시작/진행/종료 상태 관리 시스템
  - **실시간 브로드캐스트**: 전투 진행 상황을 방 내 모든 플레이어에게 실시간 전송
  - CombatSystem 클래스 개선 (자동 전투 지원)
  - 간소화된 D&D 룰 기반 데미지 계산 로직
  - 회피 및 크리티컬 히트 시스템
  - _요구사항: 4.1, 4.2_

- [ ] 23.4. 몬스터 AI 및 자동 공격 시스템 구현 (수정)

  - **어그로 시스템**: 공격적 몬스터의 자동 타겟 감지 및 추적
  - **레벨 기반 공격**: 자신보다 낮은 레벨 우선 공격 로직
  - **몬스터 AI 패턴**: 공격적/수동적/중립적 행동 패턴 구현
  - **자동 전투 시작**: 조건 만족 시 자동으로 전투 개시 시스템
  - **몬스터 간 전투**: 몬스터끼리도 전투 가능한 시스템
  - MonsterAI 클래스 구현 (로밍형/고정형 행동 패턴)
  - 어그레시브형/패시브형 몬스터 타입 구현
  - 어그로 테이블 및 타겟팅 로직
  - 전투 중 이동 제한 로직
  - _요구사항: 4.1, 4.2, 6.1_

- [ ] 23.5. 고급 전투 기능 및 최적화 구현

  - **전투 성능 최적화**: 다중 전투 동시 처리 최적화
  - **고급 AI 패턴**: 복잡한 몬스터 행동 패턴 (그룹 전투, 도망, 지원 요청)
  - **전투 이벤트 시스템**: 전투 관련 이벤트 발생 및 처리
  - **전투 밸런싱**: 레벨별 난이도 조정 및 밸런싱
  - **전투 통계**: 전투 데이터 수집 및 분석 시스템
  - _요구사항: 6.1, 4.1_

- [ ] 23.6. 경험치 및 레벨업 시스템 구현

  - 경험치 계산 및 획득 시스템
  - 레벨업 시 능력치 상승 로직
  - 레벨별 필요 경험치 테이블
  - 레벨업 알림 및 보상 시스템
  - _요구사항: 2.2, 2.3_

- [ ] 23.7. 전리품 및 드롭 시스템 구현

  - 몬스터별 드롭 테이블 설정
  - 아이템 드롭 확률 계산 시스템
  - 전리품 자동 획득 및 인벤토리 추가
  - 드롭 아이템 알림 시스템
  - _요구사항: 5.1, 5.2_

- [ ] 23.8. 웹 UI 전투 인터페이스 구현

  - 전투 상태 패널 추가 (HP/MP 바)
  - 전투 로그 영역 구현
  - 전투 액션 버튼 (공격, 방어, 도망)
  - 실시간 전투 상태 업데이트
  - _요구사항: 8.1, 8.5_

- [ ] 23.9. NPC 전투 시스템 및 우호도 구현

  - NPC 전투 가능 설정 (기본 패시브형)
  - 우호도 시스템 구현 (진영별 관계)
  - 경비병 타입 NPC 구현 (선공형)
  - NPC vs 플레이어 전투 로직
  - _요구사항: 6.1, 4.1, 4.2_

- [ ] 24. 다국어 시스템 고도화

  - **언어 선택 시스템**: 로그인 시 사용할 언어를 선택하도록 구현
  - **완전한 다국어 지원**: 모든 입출력문은 다국어 지원 (한국어/영어)
  - **동적 언어 변경**: 게임 중 언어 변경 기능 구현
  - **지역화된 콘텐츠**: 방 설명, 객체 이름, NPC 대화 등 모든 텍스트 다국어화
  - 웹 UI 언어 선택 인터페이스 추가
  - _요구사항: 10.1, 10.2, 10.3, 10.6_

- [ ] 25. 오류 처리 및 로깅 시스템 구현

  - 커스텀 예외 클래스들 정의
  - 전역 오류 핸들러 및 로깅 설정
  - 데이터베이스 트랜잭션 오류 처리
  - _요구사항: 7.3, 9.5_

- [ ] 26. 단위 테스트 작성

  - 핵심 컴포넌트들에 대한 단위 테스트
  - 데이터 모델 및 비즈니스 로직 테스트
  - 명령어 처리 및 다국어 시스템 테스트
  - _요구사항: 모든 요구사항의 검증_

- [ ] 27. 통합 테스트 및 시스템 테스트 작성

  - WebSocket 통신 테스트
  - 다중 사용자 시나리오 테스트
  - 실시간 세계 편집 기능 테스트
  - _요구사항: 7.1, 7.2_

- [ ] 28. 배포 준비
  - 설치 및 실행 스크립트 작성
  - 프로덕션 환경 설정 및 보안 강화
  - _요구사항: 1.1, 1.2_
