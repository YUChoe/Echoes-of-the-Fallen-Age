# 실시간 전투 UI 표시 시스템 구현 계획

## 개요

현재 자동 전투 시스템은 서버에서 정상 작동하지만 클라이언트에 실시간으로 표시되지 않는 문제를 해결하기 위한 구현 작업 목록입니다. 서버-클라이언트 간 메시지 전송 및 UI 업데이트 시스템을 개선하여 플레이어가 전투 상황을 실시간으로 확인할 수 있도록 구현합니다.

## 구현 작업 목록

- [-] 1. 서버 측 전투 메시지 타입 정의 및 브로드캐스트 개선

  - CombatMessageType 열거형 추가 (combat_start, combat_message, combat_status, combat_end 등)
  - AutoCombat 클래스의 _broadcast_message 메서드 개선하여 메시지 타입과 전투 상태 정보 포함
  - 전투 시작, 턴 처리, 전투 종료 시점에서 적절한 메시지 타입으로 브로드캐스트
  - _요구사항: 1.1, 1.2, 1.3, 6.1, 6.2, 6.3_

- [ ] 2. 전투 명령어 응답 메시지 개선
  - AttackCommand, DefendCommand, FleeCommand에서 전투 상태 정보를 포함한 응답 생성
  - CombatStatusCommand 응답에 실시간 전투 상태 정보 추가
  - 전투 액션 설정 시 즉시 피드백 메시지 전송
  - _요구사항: 4.1, 4.2, 4.3, 4.4_

- [ ] 3. 클라이언트 MessageHandler 전투 메시지 처리 추가
  - handleSpecificMessageTypes 메서드에 전투 관련 케이스 추가 (combat_start, combat_message, combat_status, combat_end)
  - 각 전투 메시지 타입을 GameModule의 해당 핸들러로 라우팅
  - 메시지 처리 오류 시 적절한 에러 처리 및 로깅
  - _요구사항: 2.1, 2.2, 6.4_

- [ ] 4. GameModule 전투 메시지 핸들러 구현
  - handleCombatStart 메서드: 전투 시작 메시지 표시 및 전투 UI 활성화
  - handleCombatMessage 메서드: 실시간 전투 진행 메시지 표시
  - handleCombatStatus 메서드: 전투 상태 정보 실시간 업데이트
  - handleCombatEnd 메서드: 전투 종료 메시지 표시 및 UI 정리
  - _요구사항: 2.1, 2.2, 2.3, 2.4_

- [ ] 5. 실시간 전투 상태 UI 컴포넌트 구현
  - 전투 상태 패널 HTML 구조 추가 (플레이어/몬스터 HP, 턴 정보, 타이머)
  - updateCombatStatus 메서드: HP 바, 턴 표시기, 전투 로그 실시간 업데이트
  - showCombatUI/hideCombatUI 메서드: 전투 시작/종료 시 UI 표시/숨김
  - HP 바 애니메이션 및 색상 변경 로직 구현
  - _요구사항: 3.1, 3.2, 3.3, 3.4, 5.1, 5.2_

- [ ] 6. 전투 액션 버튼 및 상호작용 구현
  - 전투 중 액션 버튼 (공격, 방어, 도망) 동적 표시
  - showActionButtons/hideActionButtons 메서드: 플레이어 턴 시 버튼 활성화
  - 턴 타이머 카운트다운 표시 및 시간 초과 처리
  - 액션 선택 시 즉시 피드백 및 버튼 비활성화
  - _요구사항: 3.3, 4.1, 4.2, 4.3, 5.3_

- [ ] 7. 전투 전용 CSS 스타일 및 애니메이션 추가
  - 전투 메시지 타입별 스타일 정의 (combat-start, combat, combat-end)
  - 전투 UI 패널 스타일 (고정 위치, 반투명 배경, 반응형 디자인)
  - HP 바 애니메이션 및 색상 그라데이션 효과
  - 크리티컬 히트, 회피 등 특수 효과 애니메이션
  - _요구사항: 5.1, 5.2, 5.3, 5.4_

- [ ] 8. 전투 메시지 성능 최적화 및 에러 처리
  - 서버 측 브로드캐스트 스로틀링 구현 (과도한 메시지 전송 방지)
  - 클라이언트 메시지 큐 시스템 구현 (순차적 메시지 처리)
  - 전투 메시지 처리 중 오류 발생 시 복구 로직
  - 메시지 검증 및 XSS 방지 처리
  - _요구사항: 모든 요구사항의 안정성 확보_

- [ ] 9. 브라우저 테스트 및 검증
  - 표준 테스트 절차에 따른 실시간 전투 UI 테스트
  - 서버 시작 → 브라우저 접속 → 로그인 → forest_7_7 이동 → 몬스터 공격
  - 전투 시작 메시지, 턴별 진행 메시지, 전투 종료 메시지 실시간 표시 확인
  - HP 바 업데이트, 턴 표시기, 액션 버튼 동작 확인
  - 브라우저 콘솔에서 메시지 수신 및 처리 로그 확인
  - _요구사항: 모든 요구사항 검증_

- [ ] 10. 문서화 및 베스트 프랙티스 업데이트
  - 실시간 전투 UI 시스템 사용법 문서 작성
  - 전투 메시지 처리 디버깅 가이드 추가
  - 발견된 문제점 및 해결 방법을 베스트 프랙티스 문서에 반영
  - 향후 전투 시스템 확장을 위한 가이드라인 작성
  - _요구사항: 개발자 경험 개선_

## 구현 우선순위

### 1단계 (핵심 기능): 작업 1-4
- 서버 측 메시지 타입 정의 및 브로드캐스트 개선
- 클라이언트 메시지 처리 및 기본 핸들러 구현
- 즉시 테스트 가능한 최소 기능 구현

### 2단계 (UI 개선): 작업 5-7
- 실시간 전투 상태 UI 컴포넌트
- 전투 액션 버튼 및 상호작용
- 전투 전용 스타일 및 애니메이션

### 3단계 (최적화 및 검증): 작업 8-10
- 성능 최적화 및 에러 처리
- 종합 테스트 및 검증
- 문서화 및 베스트 프랙티스 업데이트

## 성공 기준

- [ ] 전투 시작 시 클라이언트에 즉시 전투 시작 메시지 표시
- [ ] 각 턴 진행 시 실시간으로 액션 결과 메시지 표시
- [ ] 플레이어와 몬스터의 HP가 실시간으로 업데이트
- [ ] 플레이어 턴 시 액션 버튼이 활성화되고 선택 가능
- [ ] 전투 종료 시 결과 메시지 표시 및 UI 정리
- [ ] 브라우저 콘솔에서 전투 메시지 수신 및 처리 로그 확인 가능
- [ ] 표준 테스트 절차로 모든 기능 검증 완료

## 기술적 고려사항

### 서버 측
- 기존 AutoCombat 클래스의 _broadcast_message 메서드 확장
- 전투 상태 정보를 JSON 직렬화 가능한 형태로 구성
- 브로드캐스트 빈도 제한으로 성능 최적화

### 클라이언트 측
- MessageHandler의 handleSpecificMessageTypes 메서드 확장
- GameModule에 전투 관련 메서드 추가
- CSS 애니메이션 및 반응형 디자인 적용

### 테스트
- 실제 브라우저 환경에서 실시간 메시지 수신 확인
- 서버 로그와 클라이언트 콘솔 로그 동시 모니터링
- 캐시 문제 방지를 위한 서버 재시작 및 브라우저 새로고침

이 구현 계획은 현재 작동하는 자동 전투 시스템에 최소한의 변경으로 실시간 UI 표시 기능을 추가하는 것을 목표로 합니다.